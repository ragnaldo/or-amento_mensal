!DOCTYPE html
html lang=pt-BR
head
    meta charset=UTF-8
    meta name=viewport content=width=device-width, initial-scale=1.0
    titleDashboard de Orçamento Pessoaltitle
    
    !-- Chosen Palette Calm Finance --
    !-- Application Structure Plan A three-column responsive dashboard. Left column is for all data inputs (fixed and variable). Center column is for the detailed data log (history) with powerful filtersort controls. Right column is the high-level dashboard with summary cards and charts. This structure creates a logical user flow from input - detailed log - high-level summary. --
    !-- Visualization & Content Choices Summary - KPI Cards (HTML) - Quick overview. Expense Breakdown - Donut Chart (Chart.js) - Proportions. Category Spending - Bar Chart (Chart.js) - Comparisons. Expense Log - Dynamic Table (HTMLJS) with category filtering and multi-criteria sorting for deep data exploration. All interactions trigger instant updates. --
    !-- CONFIRMATION NO SVG graphics used. NO Mermaid JS used. --

    script src=httpscdn.tailwindcss.comscript
    script src=httpscdn.jsdelivr.netnpmchart.jsscript
    script src=httpscdnjs.cloudflare.comajaxlibshtml2canvas1.4.1html2canvas.min.jsscript
    script src=httpscdnjs.cloudflare.comajaxlibsjspdf2.5.1jspdf.umd.min.jsscript

    link rel=preconnect href=httpsfonts.googleapis.com
    link rel=preconnect href=httpsfonts.gstatic.com crossorigin
    link href=httpsfonts.googleapis.comcss2family=Interwght@400;500;600;700&display=swap rel=stylesheet
    style
        body {
            font-family 'Inter', sans-serif;
            background-color #F8F7F4;
            color #333333;
        }
        .card {
            background-color #FFFFFF;
            border-radius 1rem;
            box-shadow 0 4px 6px -1px rgb(0 0 0  0.1), 0 2px 4px -2px rgb(0 0 0  0.1);
            transition all 0.3s ease-in-out;
            height fit-content;
        }
        .balance-positive { color #22C55E; }
        .balance-negative { color #EF4444; }
        .chart-container {
            position relative;
            width 100%;
            max-width 600px;
            margin-left auto;
            margin-right auto;
            height 250px;
            max-height 300px;
        }
        -webkit-scrollbar { width 8px; }
        -webkit-scrollbar-track { background #f1f1f1; border-radius 10px; }
        -webkit-scrollbar-thumb { background #888; border-radius 10px; }
        -webkit-scrollbar-thumbhover { background #555; }
        .modal-overlay, .loading-overlay {
            transition opacity 0.3s ease;
        }
        .file-input-label {
            cursor pointer;
            border 2px dashed #cbd5e1;
            padding 1.5rem;
            display flex;
            flex-direction column;
            align-items center;
            justify-content center;
            border-radius 0.5rem;
            transition background-color 0.2s ease-in-out;
        }
        .file-input-labelhover {
            background-color #f7fafc;
        }
        select {
            -webkit-appearance none;
            -moz-appearance none;
            appearance none;
            background-image url('dataimagesvg+xml;charset=UTF-8,svg xmlns=httpwww.w3.org2000svg viewBox=0 0 20 20 fill=none stroke=currentColor stroke-width=2 stroke-linecap=round stroke-linejoin=roundpath d=M6 8l4 4 4-4svg');
            background-repeat no-repeat;
            background-position right 0.5rem center;
            background-size 1.25em;
            padding-right 2rem;
        }
    style
head
body class=p-4 mdp-8
    div id=app-container class=max-w-screen-2xl mx-auto
        header class=mb-8
            div class=flex flex-col mdflex-row justify-between items-start
                div class=text-center mdtext-left mb-4 mdmb-0
                    h1 class=text-3xl mdtext-4xl font-bold text-gray-800Meu Painel Financeiroh1
                    p class=text-gray-500 mt-2Sua vida financeira, organizada e visual.p
                div
                div class=w-full mdw-auto flex flex-col smflex-row items-center gap-4
                     div
                        label for=month-selector class=block text-sm font-medium text-gray-700 mb-1Mêslabel
                        input type=month id=month-selector class=p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500
                    div
                    div class=flex gap-2
                        button id=download-png-btn class=mt-2 smmt-6 bg-gray-600 text-white font-semibold py-2 px-4 rounded-md hoverbg-gray-700 transition-colors text-smBaixar PNGbutton
                        button id=download-pdf-btn class=mt-2 smmt-6 bg-red-700 text-white font-semibold py-2 px-4 rounded-md hoverbg-red-800 transition-colors text-smBaixar PDFbutton
                    div
                div
            div
        header

        main class=grid grid-cols-1 xlgrid-cols-3 gap-8
            
            div class=space-y-8
                 div class=card p-6
                    h2 class=text-xl font-bold mb-4Entradas e Saídas Fixash2
                    div class=grid grid-cols-1 smgrid-cols-2 gap-6
                        div id=fixed-incomes-container class=space-y-3div
                        div id=fixed-expenses-container class=space-y-3div
                    div
                div
                div class=card p-6
                    h2 class=text-xl font-bold mb-4Visão Geralh2
                    div class=text-center mb-6p class=text-gray-500SALDO DO MÊSpp id=main-balance class=text-5xl font-bold transition-colors duration-300R$ 0,00pdiv
                    div class=grid grid-cols-2 gap-4 text-center
                        div class=bg-green-50 p-3 rounded-lgp class=text-sm font-semibold text-green-800Receitaspp id=total-incomes class=text-xl font-bold text-green-600R$ 0,00pdiv
                        div class=bg-red-50 p-3 rounded-lgp class=text-sm font-semibold text-red-800Despesaspp id=total-expenses class=text-xl font-bold text-red-600R$ 0,00pdiv
                    div
                div
                div class=grid grid-cols-1 lggrid-cols-2 gap-8
                    div class=card p-6
                         h2 class=text-xl font-bold mb-4Lançar Gasto Variávelh2
                         form id=variable-expense-form class=grid grid-cols-1 gap-4 items-end
                             div
                                label for=expense-date class=text-sm font-mediumDatalabel
                                input type=date id=expense-date class=w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500 required
                            div
                            div
                                label for=expense-desc class=text-sm font-mediumDescriçãolabel
                                input type=text id=expense-desc placeholder=Ex Almoço class=w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500 required
                            div
                            div
                                label for=expense-category class=text-sm font-mediumCategorialabel
                                select id=expense-category class=w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500optionAlimentaçãooptionoptionTransporteoptionoptionLazeroptionoptionMoradiaoptionoptionSaúdeoptionoptionComprasoptionoptionOutrosoptionselect
                            div
                            div
                                label for=expense-amount class=text-sm font-mediumValor (R$)label
                                input type=number id=expense-amount placeholder=25.50 step=0.01 class=w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500 required
                            div
                            div
                                button type=submit class=w-full bg-blue-600 text-white font-bold py-2 rounded-md hoverbg-blue-700 transition-colors h-10Adicionar Gastobutton
                            div
                        form
                    div
                     div class=card p-6
                        h2 class=text-xl font-bold mb-3Importar em Loteh2
                        div class=bg-gray-50 p-4 rounded-md text-sm text-gray-700 mb-4
                           pstrongInstruçõesstrong CSV com 4 colunas strongData,Descricao,Valor,Categoriastrong (AAAA-MM-DD).p
                        div
                        label for=csv-file-input class=file-input-label text-gray-600 h-full
                            svg xmlns=httpwww.w3.org2000svg class=h-10 w-10 mb-2 fill=none viewBox=0 0 24 24 stroke=currentColor stroke-width=1path stroke-linecap=round stroke-linejoin=round d=M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-8l-4-4m0 0L8 8m4-4v12 svg
                            span id=file-chosen-text class=font-semibold text-centerClique para escolher um arquivospan
                        label
                       input type=file id=csv-file-input class=hidden accept=.csv
                       button id=import-csv-btn class=w-full mt-4 bg-green-600 text-white font-bold py-2 rounded-md hoverbg-green-700 transition-colors disabledbg-gray-400 disabledcursor-not-allowed disabledImportar Arquivobutton
                    div
                div
            div

            div class=card p-6
                div class=flex flex-col mdflex-row justify-between items-center mb-4 gap-4
                    h2 class=text-xl font-boldHistórico de Gastosh2
                    div class=flex gap-2 w-full mdw-auto
                        div class=flex-1
                            label for=filter-category class=sr-onlyFiltrar Categorialabel
                            select id=filter-category class=w-full p-2 border rounded-md bg-gray-50 text-smselect
                        div
                        div class=flex-1
                            label for=sort-history class=sr-onlyOrdenarlabel
                            select id=sort-history class=w-full p-2 border rounded-md bg-gray-50 text-smselect
                        div
                        button id=clear-history-btn title=Limpar histórico do mês class=p-2 text-gray-400 hovertext-red-500 transition-colors bg-gray-50 border rounded-mdsvg xmlns=httpwww.w3.org2000svg class=h-5 w-5 fill=none viewBox=0 0 24 24 stroke=currentColorpath stroke-linecap=round stroke-linejoin=round stroke-width=2 d=M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16 svgbutton
                    div
                div
                div class=h-[calc(100vh-20rem)] min-h-[500px] overflow-y-autotable class=w-full text-leftthead class=sticky top-0 bg-white80 backdrop-blur-smtrth class=py-2 font-semibold text-smDatathth class=py-2 font-semibold text-smDescriçãothth class=py-2 font-semibold text-sm text-rightValorthth class=py-2 font-semibold text-sm text-centerAçãothtrtheadtbody id=variable-expenses-listtbodytablep id=empty-history class=text-center text-gray-500 py-10Nenhum gasto lançado ainda.pdiv
            div

            div class=space-y-8
                div class=card p-6
                    h2 class=text-xl font-bold mb-4Análise de Despesash2
                    divh3 class=font-semibold text-center mb-2Fixas vs. Variáveish3div class=chart-containercanvas id=expenses-donut-chartcanvasdivdiv
                    div class=mt-8h3 class=font-semibold text-center mb-2Gastos por Categoriah3div class=chart-containercanvas id=expenses-bar-chartcanvasdivdiv
                div
            div
        main
    div

    div id=confirmation-modal class=modal-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50div class=bg-white rounded-lg p-8 shadow-2xl max-w-sm w-full text-centerh3 class=text-xl font-bold mb-4Tem certezah3p class=text-gray-600 mb-6Esta ação apagará todos os gastos variáveis do mês selecionado. Essa ação não pode ser desfeita.pdiv class=flex justify-center gap-4button id=cancel-clear-btn class=px-6 py-2 rounded-md text-gray-800 bg-gray-200 hoverbg-gray-300 font-semiboldCancelarbuttonbutton id=confirm-clear-btn class=px-6 py-2 rounded-md text-white bg-red-600 hoverbg-red-700 font-semiboldApagarbuttondivdivdiv
    
    div id=loading-overlay class=loading-overlay fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 hidden z-50div class=bg-white rounded-lg py-4 px-8 shadow-2xl flex items-center gap-4div class=animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600divspan class=text-lg font-semiboldGerando arquivo...spandivdiv

script
const AppState = {
    data {},
    selectedMonth '',
    charts { donut null, bar null },
    currentCategoryFilter 'all',
    currentSort 'date_desc',
    monthTemplate {
        fixedIncomes [{ id 'salario', label 'Salário', value 0.00 },{ id 'renda_extra', label 'Renda Extra', value 0.00 },{ id 'pix_karine', label 'Pix Karine', value 0.00 }],
        fixedExpenses [{ id 'financiamento', label 'Financiamento', value 0.00 },{ id 'condominio', label 'Condomínio', value 0.00 },{ id 'luz', label 'Luz', value 0.00 },{ id 'internet_celular', label 'InternetCelular', value 0.00 },{ id 'assinaturas', label 'Assinaturas', value 0.00 },{ id 'escola_vico', label 'Escola Vico', value 0.00 },{ id 'unimed', label 'Unimed', value 0.00 }],
        variableExpenses []
    },

    init() {
        const today = new Date();
        this.selectedMonth = `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        document.getElementById('month-selector').value = this.selectedMonth;
        document.getElementById('expense-date').valueAsDate = today;
        
        this.populateSortOptions();
        this.loadState();
        this.getMonthData(this.selectedMonth);
        this.createCharts();
        this.renderAll();
        this.addEventListeners();
    },
    
    renderAll() {
        this.renderFixedInputs();
        this.populateCategoryFilter();
        this.renderVariableExpenses();
        this.updateDashboard();
    },

    addEventListeners() {
        document.getElementById('month-selector').addEventListener('change', (e) = {
            this.selectedMonth = e.target.value;
            this.currentCategoryFilter = 'all';
            this.getMonthData(this.selectedMonth);
            this.renderAll();
        });
        document.getElementById('variable-expense-form').addEventListener('submit', (e) = { e.preventDefault(); this.addVariableExpense(); });
        document.getElementById('clear-history-btn').addEventListener('click', () = this.showModal('confirmation-modal'));
        document.getElementById('cancel-clear-btn').addEventListener('click', () = this.hideModal('confirmation-modal'));
        document.getElementById('confirm-clear-btn').addEventListener('click', () = this.confirmClearHistory());
        document.getElementById('confirmation-modal').addEventListener('click', (e) = { if (e.target.id === 'confirmation-modal') this.hideModal('confirmation-modal'); });
        
        document.getElementById('filter-category').addEventListener('change', (e) = {
            this.currentCategoryFilter = e.target.value;
            this.renderVariableExpenses();
        });
        document.getElementById('sort-history').addEventListener('change', (e) = {
            this.currentSort = e.target.value;
            this.renderVariableExpenses();
        });

        document.getElementById('csv-file-input').addEventListener('change', (e) = {
            const importBtn = document.getElementById('import-csv-btn');
            const fileChosenText = document.getElementById('file-chosen-text');
            if (e.target.files.length  0) {
                importBtn.disabled = false; fileChosenText.textContent = e.target.files[0].name;
            } else {
                importBtn.disabled = true; fileChosenText.textContent = 'Clique para escolher um arquivo';
            }
        });
        document.getElementById('import-csv-btn').addEventListener('click', () = this.importCSV());

        document.getElementById('download-png-btn').addEventListener('click', () = this.downloadDashboard('png'));
        document.getElementById('download-pdf-btn').addEventListener('click', () = this.downloadDashboard('pdf'));
    },

    downloadDashboard(format) {
        this.showModal('loading-overlay');
        const elementToCapture = document.getElementById('app-container');
        
        html2canvas(elementToCapture, { useCORS true, backgroundColor '#F8F7F4', onclone (doc) = { doc.getElementById('loading-overlay').style.display = 'none'; }
        }).then(canvas = {
            const fileName = `painel-financeiro-${this.selectedMonth}`;
            if (format === 'png') {
                const link = document.createElement('a');
                link.href = canvas.toDataURL('imagepng');
                link.download = `${fileName}.png`;
                link.click();
            } else if (format === 'pdf') {
                const { jsPDF } = window.jspdf;
                const imgData = canvas.toDataURL('imagejpeg', 0.9);
                const pdf = new jsPDF({ orientation canvas.width  canvas.height  'l'  'p', unit 'px', format [canvas.width, canvas.height] });
                pdf.addImage(imgData, 'JPEG', 0, 0, canvas.width, canvas.height);
                pdf.save(`${fileName}.pdf`);
            }
            this.hideModal('loading-overlay');
        }).catch(err = {
            console.error('Erro ao gerar arquivo', err);
            this.hideModal('loading-overlay');
        });
    },

    importCSV() {
        const fileInput = document.getElementById('csv-file-input');
        if (fileInput.files.length === 0) { alert('Por favor, selecione um arquivo CSV primeiro.'); return; }
        const file = fileInput.files[0];
        const reader = new FileReader();

        reader.onload = (event) = {
            const text = event.target.result;
            const lines = text.split(rn).filter(line = line.trim() !== '');
            if (lines.length  2) { alert('Arquivo CSV inválido ou vazio.'); return; }
            const header = lines[0].toLowerCase();
            if (!header.includes('data')  !header.includes('descricao')  !header.includes('valor')  !header.includes('categoria')) { alert('Cabeçalho CSV inválido. Colunas Data,Descricao,Valor,Categoria.'); return; }
            
            let newExpenses = [], importedCount = 0, skippedCount = 0;
            for (let i = 1; i  lines.length; i++) {
                const values = lines[i].split(',');
                if (values.length === 4) {
                    const date = values[0].trim(), description = values[1].trim(), amount = parseFloat(values[2]), category = values[3].trim();
                    if (^d{4}-d{2}-d{2}$.test(date) && description && !isNaN(amount) && amount  0 && category) {
                        newExpenses.push({ id Date.now() + i, date, description, amount, category });
                        importedCount++;
                    } else { skippedCount++; }
                } else { skippedCount++; }
            }
            if(newExpenses.length  0) {
                const monthData = this.getMonthData(this.selectedMonth);
                monthData.variableExpenses.push(...newExpenses);
                this.renderAll();
            }
            alert(`${importedCount} gastos importados. ${skippedCount  0  `${skippedCount} linhas ignoradas.`  ''}`);
            fileInput.value = '';
            document.getElementById('file-chosen-text').textContent = 'Clique para escolher um arquivo';
            document.getElementById('import-csv-btn').disabled = true;
        };
        reader.readAsText(file);
    },

    saveState() { localStorage.setItem('budgetAppData', JSON.stringify(this.data)); },
    loadState() {
        const savedData = localStorage.getItem('budgetAppData');
        if (savedData) this.data = JSON.parse(savedData);
    },
    getMonthData(monthKey) {
        if (!this.data[monthKey]) {
            this.data[monthKey] = JSON.parse(JSON.stringify(this.monthTemplate));
        }
        return this.data[monthKey];
    },
    renderFixedInputs() {
        const monthData = this.getMonthData(this.selectedMonth);
        const incomesContainer = document.getElementById('fixed-incomes-container');
        const expensesContainer = document.getElementById('fixed-expenses-container');
        
        let incomeInputsHTML = monthData.fixedIncomes.map(item = `divlabel for=${item.id}-${this.selectedMonth} class=text-sm font-medium${item.label}labelinput type=number id=${item.id}-${this.selectedMonth} data-id=${item.id} data-type=fixedIncomes value=${item.value.toFixed(2)} step=0.01 class=fixed-input w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500div`).join('');
        incomesContainer.innerHTML = 'h3 class=font-semibold text-green-600 mb-2Receitas Fixash3' + incomeInputsHTML + 'div class=pt-2 mt-2 border-t font-bold flex justify-betweenspanTotalspanspan id=fixed-incomes-total-displayR$ 0,00spandiv';

        let expenseInputsHTML = monthData.fixedExpenses.map(item = `divlabel for=${item.id}-${this.selectedMonth} class=text-sm font-medium${item.label}labelinput type=number id=${item.id}-${this.selectedMonth} data-id=${item.id} data-type=fixedExpenses value=${item.value.toFixed(2)} step=0.01 class=fixed-input w-full mt-1 p-2 border rounded-md bg-gray-50 focusring-2 focusring-blue-500div`).join('');
        expensesContainer.innerHTML = 'h3 class=font-semibold text-red-600 mb-2Despesas Fixash3' + expenseInputsHTML + 'div class=pt-2 mt-2 border-t font-bold flex justify-betweenspanTotalspanspan id=fixed-expenses-total-displayR$ 0,00spandiv';

        document.querySelectorAll('.fixed-input').forEach(input = {
            input.addEventListener('input', (e) = this.updateFixedValue(e.target.dataset.type, e.target.dataset.id, e.target.value));
        });
    },
    updateFixedValue(type, id, value) {
        const item = this.getMonthData(this.selectedMonth)[type].find(i = i.id === id);
        if (item) { item.value = parseFloat(value)  0; this.updateDashboard(); }
    },
    addVariableExpense() {
        const dateInput = document.getElementById('expense-date'), descInput = document.getElementById('expense-desc'), amountInput = document.getElementById('expense-amount'), categoryInput = document.getElementById('expense-category');
        const date = dateInput.value, description = descInput.value, amount = parseFloat(amountInput.value), category = categoryInput.value;
        if (!date  !description  isNaN(amount)  amount = 0) return;
        this.getMonthData(this.selectedMonth).variableExpenses.push({ id Date.now(), date, description, amount, category });
        descInput.value = ''; amountInput.value = '';
        dateInput.valueAsDate = new Date();
        this.renderAll();
    },
    deleteVariableExpense(id) {
        const monthData = this.getMonthData(this.selectedMonth);
        monthData.variableExpenses = monthData.variableExpenses.filter(exp = exp.id !== id);
        this.renderAll();
    },
    renderVariableExpenses() {
        const listEl = document.getElementById('variable-expenses-list');
        const emptyEl = document.getElementById('empty-history');
        const monthData = this.getMonthData(this.selectedMonth);
        let expensesToRender = [...monthData.variableExpenses];

        if (this.currentCategoryFilter !== 'all') {
            expensesToRender = expensesToRender.filter(exp = exp.category === this.currentCategoryFilter);
        }

        expensesToRender.sort((a, b) = {
            switch (this.currentSort) {
                case 'date_asc' return new Date(a.date) - new Date(b.date);
                case 'amount_desc' return b.amount - a.amount;
                case 'amount_asc' return a.amount - b.amount;
                case 'date_desc'
                default
                    return new Date(b.date) - new Date(a.date);
            }
        });

        listEl.innerHTML = ''; emptyEl.style.display = expensesToRender.length === 0  'block'  'none';
        expensesToRender.forEach(exp = {
            const row = document.createElement('tr');
            row.className = 'border-b border-gray-200 text-gray-700 text-sm';
            const formattedDate = new Date(exp.date + 'T000000').toLocaleDateString('pt-BR');
            row.innerHTML = `td class=py-3 px-1${formattedDate}tdtd class=py-3 px-1${exp.description}brspan class=text-xs font-semibold bg-gray-200 text-gray-800 px-2 py-1 rounded-full${exp.category}spantdtd class=py-3 px-1 text-right font-mediumR$ ${exp.amount.toFixed(2)}tdtd class=py-3 px-1 text-centerbutton onclick=AppState.deleteVariableExpense(${exp.id}) class=text-red-500 hovertext-red-700 font-bold text-lg&times;buttontd`;
            listEl.appendChild(row);
        });
    },
    getTotals() {
        const monthData = this.getMonthData(this.selectedMonth);
        const totalFixedIncomes = monthData.fixedIncomes.reduce((sum, item) = sum + item.value, 0);
        const totalFixedExpenses = monthData.fixedExpenses.reduce((sum, item) = sum + item.value, 0);
        const totalVariableExpenses = monthData.variableExpenses.reduce((sum, item) = sum + item.amount, 0);
        return { totalFixedIncomes, totalFixedExpenses, totalVariableExpenses, totalExpenses totalFixedExpenses + totalVariableExpenses, balance totalFixedIncomes - (totalFixedExpenses + totalVariableExpenses) };
    },
    updateDashboard() {
        const totals = this.getTotals();
        const mainBalanceEl = document.getElementById('main-balance');
        mainBalanceEl.textContent = `R$ ${totals.balance.toFixed(2)}`;
        mainBalanceEl.className = 'text-5xl font-bold transition-colors duration-300 ' + (totals.balance = 0  'balance-positive'  'balance-negative');
        document.getElementById('total-incomes').textContent = `R$ ${totals.totalFixedIncomes.toFixed(2)}`;
        document.getElementById('total-expenses').textContent = `R$ ${totals.totalExpenses.toFixed(2)}`;
        
        document.getElementById('fixed-incomes-total-display').textContent = `R$ ${totals.totalFixedIncomes.toFixed(2)}`;
        document.getElementById('fixed-expenses-total-display').textContent = `R$ ${totals.totalFixedExpenses.toFixed(2)}`;

        this.updateCharts(totals);
        this.saveState();
    },
    showModal(modalId) { document.getElementById(modalId).classList.remove('hidden'); },
    hideModal(modalId) { document.getElementById(modalId).classList.add('hidden'); },
    confirmClearHistory() {
        this.getMonthData(this.selectedMonth).variableExpenses = [];
        this.hideModal('confirmation-modal'); this.renderAll();
    },
    populateCategoryFilter() {
        const filterEl = document.getElementById('filter-category');
        const categories = new Set(this.getMonthData(this.selectedMonth).variableExpenses.map(exp = exp.category));
        filterEl.innerHTML = 'option value=allTodas as Categoriasoption';
        categories.forEach(cat = {
            const option = document.createElement('option');
            option.value = cat;
            option.textContent = cat;
            filterEl.appendChild(option);
        });
        filterEl.value = this.currentCategoryFilter;
    },
    populateSortOptions() {
        const sortEl = document.getElementById('sort-history');
        const options = {
            'date_desc' 'Data (Mais Recente)',
            'date_asc' 'Data (Mais Antiga)',
            'amount_desc' 'Valor (Maior)',
            'amount_asc' 'Valor (Menor)'
        };
        sortEl.innerHTML = '';
        for (const [value, text] of Object.entries(options)) {
            const option = document.createElement('option');
            option.value = value;
            option.textContent = text;
            sortEl.appendChild(option);
        }
        sortEl.value = this.currentSort;
    },
    createCharts() {
        Chart.defaults.font.family = 'Inter', sans-serif;
        if (this.charts.donut) this.charts.donut.destroy();
        if (this.charts.bar) this.charts.bar.destroy();
        this.charts.donut = new Chart(document.getElementById('expenses-donut-chart').getContext('2d'), { type 'doughnut', data { labels ['Despesas Fixas', 'Despesas Variáveis'], datasets [{ data [0, 0], backgroundColor ['#F87171', '#FBBF24'], borderColor '#FFFFFF', borderWidth 2 }] }, options { responsive true, maintainAspectRatio false, plugins { legend { position 'bottom' } } } });
        this.charts.bar = new Chart(document.getElementById('expenses-bar-chart').getContext('2d'), { type 'bar', data { labels [], datasets [{ label 'Gasto por Categoria', data [], backgroundColor '#60A5FA' }] }, options { responsive true, maintainAspectRatio false, indexAxis 'y', plugins { legend { display false } }, scales { x { beginAtZero true }, y { ticks { autoSkip false } } } } });
    },
    updateCharts(totals) {
        if (!this.charts.donut  !this.charts.bar) return;
        this.charts.donut.data.datasets[0].data = [totals.totalFixedExpenses, totals.totalVariableExpenses];
        this.charts.donut.update();
        const categoryTotals = this.getMonthData(this.selectedMonth).variableExpenses.reduce((acc, exp) = { acc[exp.category] = (acc[exp.category]  0) + exp.amount; return acc; }, {});
        const sortedCategories = Object.entries(categoryTotals).sort((a, b) = b[1] - a[1]);
        this.charts.bar.data.labels = sortedCategories.map(item = item[0]);
        this.charts.bar.data.datasets[0].data = sortedCategories.map(item = item[1]);
        this.charts.bar.update();
    }
};
document.addEventListener('DOMContentLoaded', () = AppState.init());
script
body
html
